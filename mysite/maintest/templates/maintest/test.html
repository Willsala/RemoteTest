<!DOCTYPE html>
<html lang="zh-CN">
</head>
{% load static %}
<meta charset="utf-8">
<title>Test App in Bootstrap!</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="{% static 'maintest/js/jquery.js' %}"></script>
<link rel="stylesheet" href="{% static 'maintest/bootstrap/css/bootstrap.css' %}">
<script type="text/javascript" src="{% static 'maintest/bootstrap/js/bootstrap.min.js' %}"></script>


<script type="text/javascript" src="{% static 'maintest/js/bootstrap-treeview.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'maintest/css/bootstrap-treeview.css' %}">

<script type="text/javascript" src="{% static 'maintest/js/maintest_js.js' %}"></script>
<script type="text/javascript" src="{% static 'maintest/js/add4cre_up.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.form.js' %}" ></script>
<link rel="stylesheet" type="text/css" href="{% static 'maintest/WaveDrawJS/css/WaveDrawJS.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'maintest/css/maintest.css' %}">
<script src="{% static 'maintest/WaveDrawJS/script/loadjson.js' %}"></script>
<!-- <script src="{% static 'maintest/WaveDrawJS/script/miscscript.js' %}"></script> -->
<script>
    // define django template tag variables
    var build_url = "{% url 'maintest:build' %}";
    var check_url = "{% url 'maintest:check' %}";
    var test_url = "{% url 'Users:test_request' %}";
    var report_url = "{% url 'maintest:report' %}";
    var tv_ajax_url = "{% url 'maintest:tv_ajax' %}";
    var vcd2pic_url = "{% url 'maintest:vcd2picjson' %}";
    var uservcdfile = "{{ file_path }}";


</script>
<script>
var currentTVPath = ''; //delete when class MainTest available.
var files = [];
var upload_dir = true;
$(document).ready(function() {
	$("#file").change(function() {
		files = this.files;
		console.log(this.files);
		console.log(this.files.length);
	});
	$('#file_input_pack').click(function() {
		$('#file').click();
	});
	$("#upload-btn").click(function() {
		var fd = new FormData();
		var file_loc = $("#file_loc").val();
		$("#myModal_2").modal('hide');
		$("#progress").show();
		var $progressBar = $("#progress-bar");

		// Initialize the progress bar.
		$progressBar.css({
			"width": "0%"
		});
		for (var i = 0; i < files.length; i++) {
			fd.append("file", files[i]);
			if(upload_dir)
				fd.append("paths", files[i]['webkitRelativePath']);
		}
		$.ajax({
			xhr: function() {
				var xhrobj = $.ajaxSettings.xhr();
				if (xhrobj.upload) {
					xhrobj.upload.addEventListener("progress",
					function(event) {
						var percent = 0;
						var position = event.loaded || event.position;
						var total = event.total;
						if (event.lengthComputable) {
							percent = Math.ceil(position / total * 100);
						}

						// Set the progress bar.
						$progressBar.css({
							"width": percent + "%"
						});
						$progressBar.text(percent + "%");
					},
					false)
				}
				return xhrobj;
			},

			url: "/Users/upload/",
			async: true,
			method: "POST",
			data:fd,
			contentType: false,
			processData: false,
			cache: false,
			success: function(data) {
				msg_show(data);
				$("#progress").css('display','none');
				loadTreeview(currentTVPath);
			}
		});
	});

	$("#typical-test").click(function() //to delete
	{
		html = '<form>Location:<input type="text" id="t-p-path"></form>';
		$("#s-p-body").html(html);
	});
	$("#submit-t-p-path").click(function() //submit path to be opened
	{
		currentTVPath = $('#t-p-path').val();
		loadTreeview(currentTVPath);
		$('#strat-project-modal').modal('hide')
	});
	$("#refresh_tree").click(function() //refresh the file tree
	{
		loadTreeview(currentTVPath);
	});
});   

</script>
<script>
    $(document).ready(function(){
      $(".expand-icon").click(function(){
        console.log('hello2');
        console.log($(this).attr("data-nodeid"));
        console.log('hello3');
      });
    });


</script>
<script>
    $(document).ready(function(){
      $("[href=#edit_text]").click(function(){
        console.log('select file');
      });
      $("#submit-edit-text").click(function(){
        console.log('start editing file');
        var text = $("#edit-text").val();
        var data = {
          text: text,
          path: "{{file_path}}"
        };
        $.ajax({
          type: 'POST',
          url: "{% url 'maintest:save_file' %}",
          data: data,
          success: function(data){
            console.log(data);
            if(data == 'Success!')
              alert("修改成功!");
            else
              alert("修改失败QAQ!\n" + data);
          }
        });
      });
    });

    function uploadFile(path){
      window.location.href = "{% url 'files:browse' %}?dir=" + path;
    }


</script>
</head>

<body>
<div class="container">
	
	<div>
		{% include "maintest/include/account.html" %}
	</div>
	<div id ="message"></div>
  <div class="row">
    <div class="col-md-3" style="vertical-align:middle;font-size:20px">
      <p>&nbsp;Chip-Test App
        <small>testing</small>
      </p>
    </div>
	
	
	
    <div class="col-md-6">
      <!--Toolbar-->
      {% include "maintest/include/toolbar.html" %}
    </div>
    <div class="col-md-3">
    </div><!-- /.col-lg-6 -->
  </div>
  <br>

  <div class="row">
    <div class="col-md-3"
         style="background-color: #dedef8;box-shadow:
                   inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
      <h4>tool window</h4>
      <div class="row">
        <div class="col-md-12"
             style="background-color: #dedef8;box-shadow:
                           inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
          <p>file tree</p>
          <div id="tree"></div>
		  <fieldset id="progress" style="display: none">
				<p>Files Progress</p>
				<div class="progress">
					<div id="progress-bar" class="progress-bar">0%</div>
				</div>
		  </fieldset>
          <div class="btn-group">
			<button type="button" class="btn btn-default" data-toggle="modal" data-target="#myModal_1">create dir</button>
			<button type="button" class="btn btn-default dropdown-toggle" onclick="clear_files()" id="dropdownMenu4upload" data-toggle="dropdown">upload</button>
			<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu4upload">
				<li role="presentation">
				  <a role="menuitem" tabindex="-1" data-toggle="modal" onclick="input_property4files()" href="#myModal_2">upload files</a>
				</li>
				<li role="presentation">
				  <a role="menuitem" tabindex="-1" data-toggle="modal" onclick="input_property4dirs()" href="#myModal_2">upload dirs</a>
				</li>
			</ul>
			<button id="refresh_tree" type="button" class="btn btn-default">
            refresh 
			</button>
		  </div>
		  <div>
			
		  </div>
          
          <br><br>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12"
             style="background-color: #dedef8;box-shadow:
                           inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
          <p>stream</p>
          {% include "maintest/include/stream_status.html" %}
        </div>
      </div>
    </div>
    <div class="col-md-9"
         style="background-color: #dedef8;box-shadow:
                   inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
      <!--load the selected file an edit it here-->
      <div class="row">
        <div class="col-md-12"
             style="background-color: #ffffff;box-shadow:
                           inset 1px -1px 1px #444, inset -1px 1px 1px #444;padding:10px;">
          <ul id="myTab" class="nav nav-tabs">
            <li class="active">
              <a href="#home" data-toggle="tab">
                {{file_name}}
              </a>
            </li>
            <li class="pull-right">
              <button id="submit-edit-text" type="submit" class="btn btn-default">submit</button>
            </li>
          </ul>
          <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade in active" id="home">
              <textarea id="edit-text" class="form-control" rows="10">{{ file_content }}</textarea>
            </div>
            <div class="tab-pane fade" id="ios">
              <p>some comtent</p>
            </div>
          </div>
          <br>
        </div>
      </div>
      <div class="row">
        <h4>Waveform</h4>
        <div class='wavedrawing-'>
          <div class='wavedraw-menu'>
            <button id="wavedraw-reset" class="btn btn-default">Reload Image</button>
            <button id="wavedraw-cursor" class="btn btn-default">Cursor Mode</button>
            <button id="wavedraw-zoom" class="btn btn-default">Zoom Mode</button>
          </div>
          <div>
            <li id="wavedrawing-heading-text">Signals</li><!--用注释去除空白
         --><div class="column-sep"></div><!--用注释去除空白
         --><canvas id="wavedrawing-gridc">
          </div>
          <div class="wavedrawing-container">
            <div id="namel-"><ul class="inner-list"></ul></div><!--用注释去除空白
         --><div class='column-sep'></div><!--用注释去除空白
         --><div id="canvasl-"><ul class="inner-list"></ul></div>
            <div id="cursor-"></div>
          </div>
          <div id="wavedraw-cursor-info"></div>
          <br>
          <p class='.timebar'>Now showing <span><input type="text" style="display:none"><text> to </text><input type="text" style="display:none"><button style="display:none">Go</button></span> .</p>
          <p>propotion<input id="propotion-" type="range" min="0" max="1000" value="1000"></p>
          <p>width<input id="width-" type="range" min="0" max="1000" value="1000"></p>
        <script src="{% static 'maintest/WaveDrawJS/script/utils.js' %}"></script>
        <script src="{% static 'maintest/WaveDrawJS/script/draw.js' %}"></script>
        <script src="{% static 'maintest/WaveDrawJS/script/controller.js' %}"></script>
        </div>
      </div>
        
      </div>
    </div>
  </div>
</div>




{% include "maintest/include/tools.html" %}
<script>
   generateFileTree({{obj|safe}});
   treeviewOpenProject({{tv_dir|safe}});
</script>
<script>
$(function() {
    $('#strat-project-modal').modal('hide')
});


</script>
</body>
</html>
